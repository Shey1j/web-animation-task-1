<template>
  <div ref="preloader" class="c-preloader">
    <div id="preloader-wrapper">
      <div class="c-preloader__icon">
        <svg
          id="Group_21496"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          data-name="Group 21496"
          width="84.101"
          height="99.363"
          viewBox="0 0 84.101 99.363"
        >
          <defs>
            <clipPath id="clip-path">
              <path id="Path_33982" data-name="Path 33982" d="M851.539,302.458V245.619A41.59,41.59,0,0,0,809.95,204.03v34.625a21.361,21.361,0,0,1,8.154,1.714,19,19,0,0,1,11.554,20.214c-.317,1.851-1.094,7.286-7.4,12.333A18.931,18.931,0,0,1,810,277.047c.005,1.441-.049,25.413-.049,25.413h41.589Z" transform="translate(-809.95 -204.03)" />
            </clipPath>
            <clipPath id="clip-path-5">
              <path id="Path_33991" data-name="Path 33991" d="M689.6,302.458H648.36V245.619A41.291,41.291,0,0,1,689.6,204.03" transform="translate(-648.36 -204.03)" />
            </clipPath>
          </defs>
          <path id="Path_33979" data-name="Path 33979" d="M648.36,302.458V245.619a41.59,41.59,0,0,1,41.589-41.589h0a41.591,41.591,0,0,1,41.589,41.589v56.839H648.36Z" transform="translate(-647.898 -203.577)" />
          <g id="Group_21406" data-name="Group 21406" transform="translate(42.051 0.453)">
            <path id="Path_33980" data-name="Path 33980" d="M851.539,302.458V245.619A41.59,41.59,0,0,0,809.95,204.03v34.625a21.361,21.361,0,0,1,8.154,1.714,19,19,0,0,1,11.554,20.214c-.317,1.851-1.094,7.286-7.4,12.333A18.931,18.931,0,0,1,810,277.047c.005,1.441-.049,25.413-.049,25.413h41.589Z" transform="translate(-809.95 -204.03)" fill="#ffd91a" />
            <g id="Group_21402" data-name="Group 21402" transform="translate(0 0)" clip-path="url(#clip-path)">
              <path id="Path_33981" data-name="Path 33981" d="M785.432,305.371q34.437,34.452,68.876,68.9,9.787,9.791,19.576,19.584c3.166,3.166,8.082-1.745,4.913-4.913q-34.437-34.452-68.876-68.9-9.787-9.791-19.576-19.584c-3.163-3.168-8.079,1.745-4.913,4.913Z" transform="translate(-790.984 -274.88)" fill="#fff9a5" />
            </g>
            <g id="Group_21403" data-name="Group 21403" transform="translate(0 0)" clip-path="url(#clip-path)">
              <path id="Path_33983" data-name="Path 33983" d="M783.325,529.608q15.381,14.914,30.319,30.275c.927.952,2.381-.5,1.457-1.457q-14.937-15.358-30.319-30.275c-.952-.921-2.409.533-1.457,1.457Z" transform="translate(-789.947 -444.512)" fill="#fff9a5" />
            </g>
            <g id="Group_21404" data-name="Group 21404" transform="translate(0 0)" clip-path="url(#clip-path)">
              <path id="Path_33985" data-name="Path 33985" d="M785.966,568.769q10.061,10.076,20.122,20.155c1.874,1.879,4.787-1.032,2.911-2.911q-10.061-10.076-20.122-20.155c-1.874-1.879-4.785,1.032-2.911,2.911Z" transform="translate(-791.69 -472.282)" fill="#fff9a5" />
            </g>
            <g id="Group_21405" data-name="Group 21405" transform="translate(0 0)" clip-path="url(#clip-path)">
              <path id="Path_33987" data-name="Path 33987" d="M815.1,193.853l47.908,47.908,13.427,13.427c1.876,1.876,4.79-1.035,2.911-2.911l-47.908-47.908L818.01,190.942c-1.876-1.876-4.79,1.035-2.911,2.911Z" transform="translate(-813.323 -193.861)" fill="#fff9a5" />
            </g>
          </g>
          <g id="Group_21410" data-name="Group 21410" transform="translate(0.462 0.453)">
            <path id="Path_33989" data-name="Path 33989" d="M689.6,302.458H648.36V245.619A41.291,41.291,0,0,1,689.6,204.03" transform="translate(-648.36 -204.03)" fill="#ffd91a" />
            <g id="Group_21407" data-name="Group 21407" transform="translate(0 0)" clip-path="url(#clip-path-5)">
              <path id="Path_33990" data-name="Path 33990" d="M596.01,411.011q25.206,25.2,50.41,50.409L660.1,475.105a6.563,6.563,0,1,0,9.281-9.281l-50.41-50.409L605.291,401.73a6.563,6.563,0,1,0-9.281,9.281Z" transform="translate(-608.091 -349.442)" fill="#fff9a5" />
            </g>
            <g id="Group_21408" data-name="Group 21408" transform="translate(0 0)" clip-path="url(#clip-path-5)">
              <path id="Path_33992" data-name="Path 33992" d="M634.848,380.735l43.2,43.2,11.991,11.991a1.031,1.031,0,0,0,1.457-1.457l-43.2-43.2L636.3,379.279a1.031,1.031,0,0,0-1.457,1.457Z" transform="translate(-638.101 -333.95)" fill="#fff9a5" />
            </g>
            <g id="Group_21409" data-name="Group 21409" transform="translate(0 0)" clip-path="url(#clip-path-5)">
              <path id="Path_33994" data-name="Path 33994" d="M682.687,203.577l50.394,50.394,14.14,14.14a3.86,3.86,0,0,0,5.459-5.459l-50.394-50.394-14.14-14.14a3.86,3.86,0,0,0-5.459,5.459Z" transform="translate(-673.028 -198.819)" fill="#fff9a5" />
            </g>
          </g>
          <ellipse
            id="Ellipse_4147"
            data-name="Ellipse 4147"
            cx="19.872"
            cy="19.154"
            rx="19.872"
            ry="19.154"
            transform="matrix(0.78, -0.625, 0.625, 0.78, 14.544, 51.783)"
            fill="#ffd916"
          />
          <path id="Path_33996" data-name="Path 33996" d="M767.161,343.794a18.278,18.278,0,0,1,3.938,10.635,19.487,19.487,0,0,1-2.906,10.951,20.274,20.274,0,0,1-9.049,7.845,19.516,19.516,0,0,1-11.381,1.323,18.432,18.432,0,0,1-10.015-5.454,18.179,18.179,0,0,1-4.782-10.326,19.367,19.367,0,0,1,2.077-11.093,20.236,20.236,0,0,1,8.46-8.478,19.708,19.708,0,0,1,11.317-2.162,18.431,18.431,0,0,1,10.334,4.625,18.731,18.731,0,0,1,2.008,2.134.462.462,0,0,0,.651,0,.472.472,0,0,0,0-.651,19.2,19.2,0,0,0-10.068-6.5,20.378,20.378,0,0,0-11.95.543,21.248,21.248,0,0,0-10.038,7.569,20.483,20.483,0,0,0-3.83,11.276A19.068,19.068,0,0,0,744.8,374.717a20.239,20.239,0,0,0,11.906.34,21.1,21.1,0,0,0,10.529-6.795,20.665,20.665,0,0,0,4.689-11.1,19.379,19.379,0,0,0-2.412-11.528,19.652,19.652,0,0,0-1.709-2.5.465.465,0,0,0-.651,0A.475.475,0,0,0,767.161,343.794Z" transform="translate(-709.95 -301.579)" />
          <path id="Path_33997" data-name="Path 33997" d="M748.205,377.923a16.551,16.551,0,0,1-6.555-13.785c0-8.069,5.86-15.074,14.248-17.038l.587,2.507c-7.219,1.688-12.261,7.665-12.261,14.531a14.15,14.15,0,0,0,5.6,11.783Z" transform="translate(-717.178 -309.824)" fill="#fcf8b3" />
          <ellipse
            id="Ellipse_4148"
            data-name="Ellipse 4148"
            cx="6.576"
            cy="6.337"
            rx="6.576"
            ry="6.337"
            transform="matrix(0.78, -0.625, 0.625, 0.78, 32.732, 53.636)"
          />
          <path id="Path_33998" data-name="Path 33998" d="M774.776,354.931l-3.886-6.017-.548-.849c-.322-.5-1.12-.036-.8.466l3.886,6.017.548.849c.324.5,1.122.036.8-.466Z" transform="translate(-737.836 -310.382)" />
          <path id="Path_33999" data-name="Path 33999" d="M765.308,363.545q-1.2-1.332-2.4-2.661l-.34-.378a.46.46,0,1,0-.651.651q1.2,1.332,2.4,2.661l.34.378a.46.46,0,0,0,.651-.651Z" transform="translate(-732.131 -319.681)" />
          <path id="Path_34000" data-name="Path 34000" d="M805.495,339.81c-.013-.667-.026-1.336-.039-2,0-.1,0-.193-.005-.288a.461.461,0,1,0-.921,0c.013.667.026,1.336.039,2,0,.1,0,.193.005.288a.461.461,0,1,0,.921,0Z" transform="translate(-763.874 -302.367)" />
          <path id="Path_34001" data-name="Path 34001" d="M826.562,345.981q.564-2.506,1.13-5.011c.054-.237.108-.476.162-.713.131-.579-.759-.826-.891-.245q-.564,2.506-1.13,5.011c-.054.237-.108.476-.162.713-.131.579.759.826.89.245Z" transform="translate(-779.565 -304.314)" />
          <path id="Path_34002" data-name="Path 34002" d="M849.987,355.443q.846-.78,1.691-1.562l.239-.219a.465.465,0,0,0,0-.651.47.47,0,0,0-.651,0q-.845.78-1.691,1.562l-.239.219a.464.464,0,0,0,0,.651.469.469,0,0,0,.651,0Z" transform="translate(-797.049 -314.117)" />
          <path id="Path_34003" data-name="Path 34003" d="M840.693,367.454q3.019-2.3,6.035-4.6c.288-.221.579-.44.867-.661a.476.476,0,0,0,.165-.631.462.462,0,0,0-.631-.165q-3.019,2.3-6.035,4.6c-.288.221-.579.44-.867.661a.475.475,0,0,0-.165.631.462.462,0,0,0,.631.165Z" transform="translate(-790.215 -320.387)" />
          <path id="Path_34004" data-name="Path 34004" d="M857.9,401.927l5.673-1.181c.265-.057.533-.111.8-.167.582-.121.335-1.011-.245-.891l-5.673,1.181c-.265.057-.533.111-.8.167-.582.124-.335,1.011.245.891Z" transform="translate(-803.077 -348.869)" />
          <path id="Path_34005" data-name="Path 34005" d="M864.691,417.1c.919.018,1.835.036,2.754.057l.4.008a.461.461,0,1,0,0-.921c-.919-.018-1.835-.036-2.754-.057l-.4-.008a.461.461,0,0,0,0,.921Z" transform="translate(-808.209 -361.125)" />
          <path id="Path_34006" data-name="Path 34006" d="M744.034,391.784l-6.416-1.974-.927-.286c-.569-.175-.813.716-.245.891l6.416,1.974.927.286c.569.175.811-.716.245-.891Z" transform="translate(-713.073 -341.313)" />
          <path id="Path_34007" data-name="Path 34007" d="M744.886,429.949l-6.393,2.656-.919.381a.475.475,0,0,0-.322.566.462.462,0,0,0,.566.322l6.393-2.656.919-.381a.475.475,0,0,0,.322-.566.462.462,0,0,0-.566-.322Z" transform="translate(-713.9 -371.332)" />
          <path id="Path_34008" data-name="Path 34008" d="M737.141,425.152l-2.911.947-.417.136a.471.471,0,0,0-.322.569.466.466,0,0,0,.566.322l2.911-.947.417-.136a.469.469,0,0,0,.322-.566.459.459,0,0,0-.566-.324Z" transform="translate(-711.107 -367.773)" />
          <path id="Path_34009" data-name="Path 34009" d="M757.045,449.894q-1.845,1.656-3.688,3.312c-.175.157-.35.314-.522.471-.443.4.211,1.048.651.651q1.845-1.656,3.688-3.312c.175-.157.35-.314.522-.471.445-.4-.211-1.047-.651-.651Z" transform="translate(-725.374 -386.07)" />
          <path id="Path_34010" data-name="Path 34010" d="M799.3,451.092q-.239,4.077-.476,8.151c-.023.386-.044.77-.067,1.156-.034.592.888.592.924,0q.239-4.077.476-8.151c.023-.386.044-.77.067-1.156.033-.592-.891-.589-.924,0Z" transform="translate(-759.586 -386.722)" />
          <path id="Path_34011" data-name="Path 34011" d="M841.046,439.163q2.722,2.386,5.446,4.772c.257.224.512.45.77.674.445.389,1.1-.26.651-.651q-2.722-2.386-5.446-4.772c-.257-.224-.512-.45-.77-.674-.445-.391-1.1.26-.651.651Z" transform="translate(-790.88 -377.619)" />
          <path id="Path_34012" data-name="Path 34012" d="M837.471,453.591l2.275,3.171c.108.152.219.3.327.456a.472.472,0,0,0,.631.165.462.462,0,0,0,.165-.631l-2.275-3.171c-.108-.152-.219-.3-.327-.456a.472.472,0,0,0-.631-.165.467.467,0,0,0-.165.631Z" transform="translate(-788.288 -388.393)" />
          <path id="Path_34013" data-name="Path 34013" d="M808.209,488.423q-.012,6.212-.023,12.421-.012,5.212-.021,10.426c0,.685,0,1.369-.005,2.054a.461.461,0,0,0,.921,0q.008-2.953.013-5.9.012-6.123.023-12.246.008-3.374.013-6.751a.461.461,0,0,0-.921,0Z" transform="translate(-766.569 -414.444)" />
          <path id="Path_34014" data-name="Path 34014" d="M808.094,202.743v30.082c0,1.38-.052,2.769,0,4.146v.057a.461.461,0,0,0,.921,0V206.946c0-1.38.051-2.769,0-4.146v-.057a.461.461,0,0,0-.921,0Z" transform="translate(-766.503 -202.29)" />
          <path id="Path_34015" data-name="Path 34015" d="M647.491,301.151V245.427a46.437,46.437,0,0,1,.816-9.3,41.128,41.128,0,0,1,81.439,8.21c0,1.325,0,2.654,0,3.979v52.847l.461-.461h-79.8c-1.081,0-2.165-.026-3.246,0h-.136a.462.462,0,0,0,0,.924h79.8c1.081,0,2.164.026,3.245,0h.136a.467.467,0,0,0,.461-.461v-55.93a46.33,46.33,0,0,0-1.03-10.2,41.876,41.876,0,0,0-7.219-15.726,42.042,42.042,0,0,0-75.851,25.012c0,1.217,0,2.435,0,3.652v53.187A.462.462,0,0,0,647.491,301.151Z" transform="translate(-646.566 -202.27)" />
        </svg>
      </div>
      <div class="c-preloader__text">
        {{ percentageLoaded }}%
      </div>
      <p class="c-preloader__label">
        Designing your experienceâ€¦
      </p>
    </div>
  </div>
</template>

<script>
// import { gsap } from 'gsap'
import preloadImage from '~/utils/index.js'
export default {
  data () {
    return {
      toBePreloaded: [
        'https://res.cloudinary.com/pineappledesign/image/upload/q_auto,f_auto/v1649731993/pineapple-website/theCofounders_vkzemm.png',
        'https://res.cloudinary.com/pineappledesign/image/upload/q_auto,f_auto/v1649731769/pineapple-website/Discovering_the_unforeseen_sshovu.png',
        'https://res.cloudinary.com/pineappledesign/image/upload/q_auto,f_auto/v1649731784/pineapple-website/Transforming_the_experience_nz7mbb.png',
        'https://res.cloudinary.com/pineappledesign/image/upload/q_auto,f_auto/v1649731763/pineapple-website/Designing_for_impact_sjg1dx.png',
        'https://res.cloudinary.com/pineappledesign/image/upload/q_auto,f_auto/v1649731777/pineapple-website/Scaling_to_be_relevant_ih8jnq.png',
        'https://admin.pineapple.design//uploads/ahandoff_compressed_06eca83de6.jpg',
        'https://admin.pineapple.design//uploads/genz_vs_millennial_Cover_min_11839d9986.png'
      ],
      percentageLoaded: 0,
      isLoaded: false,
      numbersArr: []
    }
  },
  mounted () {
    const preloader = this.$refs.preloader
    this.preload()

    preloader.style.height = `${window.innerHeight}px`

    window.addEventListener('resize', () => {
      preloader.style.height = `${window.innerHeight}px`
    })
  },
  methods: {
    async preload () {
      const totalImages = this.toBePreloaded.length
      let loadedCount = 0

      const min3Digits = (num) => {
        if (num < 10) {
          return `00${num}`
        } else if (num < 99) {
          return `0${num}`
        }
        return `${num}`
      }
      this.toBePreloaded.forEach((image, index) => {
        const percentage = Math.floor((100 / totalImages) * (index + 1))
        this.numbersArr = [...this.numbersArr, min3Digits(percentage)]
      })

      await Promise.all(
        this.toBePreloaded.map(async (image, index) => {
          await preloadImage(image)
          loadedCount++
          const percentage = Math.floor((100 / totalImages) * loadedCount)
          this.percentageLoaded = percentage
          const otherWrapperPath = document.getElementById('Path_33996')
          const wrapperPath = document.getElementById('Path_33997')
          const minorPaths = document.getElementsByTagName('path')
          const path = document.getElementById('Path_33979')
          const allWrapper = document.getElementsByTagName('svg')[0]
          const preloadText = document.getElementsByClassName('c-preloader__text')[0]
          const preloadLabel = document.getElementsByClassName('c-preloader__label')[0]
          const elllipseElements = document.querySelectorAll('ellipse')
          const rightGroup = document.getElementById('Group_21406')
          const leftGroup = document.getElementById('Group_21410')
          const preloadWrapper = document.getElementById('preloader-wrapper')
          // const preloadIcon = document.getElementsByClassName('c-preloader__icon')[0]
          const body = document.getElementsByClassName('c-preloader')[0]
          const minorPathsArray = [...minorPaths]
          preloadText.classList.add('fade-out')
          preloadLabel.classList.add('fade-out')
          elllipseElements[0].setAttribute('class', 'open-left')
          elllipseElements[1].setAttribute('class', 'open-left')
          minorPathsArray.forEach((path) => {
            if (parseInt(path.id.replace('Path_', '')) > 33997 && parseInt(path.id.replace('Path_', '')) < 34014) {
              path.setAttribute('class', 'fade-out')
            }
          })
          rightGroup.setAttribute('class', 'open-right')
          leftGroup.setAttribute('class', 'open-left')
          wrapperPath.setAttribute('class', 'fade-out')
          otherWrapperPath.setAttribute('class', 'rotate-right')
          path.setAttribute('class', 'expand')
          // preloadIcon.classList.add('open')
          preloadWrapper.classList.add('open')
          allWrapper.setAttribute('class', 'open')
          allWrapper.setAttribute('preserveAspectRatio', 'xMidYMid slice')
          body.classList.add('back-color')
          setTimeout(() => {
            this.$store.commit('updateImagesLoaded', true)
          }, 4000)
        })
      )
    }
  }
}
</script>

<style scoped>
html {
  font-size:calc(100vw / 1366 * 10);
}

@keyframes blink {
    0% {
        opacity: 0;
    }
    50% {
        opacity: .5;
    }
    100% {
        opacity: 1;
    }
}

.c-preloader {
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100vh;
    z-index:5;
    display:grid;
    place-items:center;
    background-color:#fff;
    text-align:center
}
.c-preloader__icon {
    margin:0 auto;
    margin-bottom:24px
}
.c-preloader__text {
    font-size:1.8rem;
    line-height:calc(26 / 20);
    font-family:Telegraf,sans-serif;
    color:#000;
    margin-bottom:4px;
    opacity: 1;
    visibility: visible;
}
.c-preloader__label {
    font-size:1.4rem;
    line-height:calc(25 / 16);
    font-family:Telegraf,sans-serif;
    color:#8f959f;
    margin-bottom:0;
    margin-top:0;
    animation: blink 3s ease-in-out infinite;
    opacity: 1;
    visibility: visible;
}

.fade-out {
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
}

.rotate-right {
  transform-origin: -30% 40%;
  transform:rotate(45deg);
}

.rotate-other-right {
  transform-origin: -8% 32%;
  /* transform:rotate(45deg); */
}

.open {
  animation: draw 3s linear forwards;
  /* overflow: hidden; */
}

@keyframes draw {
  to {
    width: 110vw;
    height: 100%;
  }
}

.open-right {
    animation: open-right 1s ease-in-out forwards;
}

@keyframes open-right {
    100% {
        transform: translate(100%, 0);
        opacity: 0;
    }
}

.open-left {
    animation: open-left 1s ease-in-out forwards;
}

/* .open-left-ish {
    animation: open-left-ish 1s ease-in-out forwards;
} */

@keyframes open-left {
    100% {
        transform: translate(-100%, 0);
        opacity: 0;
    }
}

/* @keyframes open-left-ish {
    100% {
        transform: translate(100%, -40%);
        opacity: 0;
    }
} */

.expand {
    animation: expand 1.2s ease-in-out forwards;
}

@keyframes expand {
   to {
    width: 100%;
    height: 100%;
   }
}

.back-color {
    background-color: #000;
    transition: background-color 1.725s ease-in-out;
}
</style>
